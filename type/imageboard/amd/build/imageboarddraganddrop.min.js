define("unilabeltype_imageboard/imageboarddraganddrop",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;_exports.init=()=>{let selectedImage={number:null};selectedImage.number=null,selectedImage.src="",selectedImage.itemToMove=null,selectedImage.eventlayerX=0,selectedImage.eventlayerY=0,selectedImage.width=null,selectedImage.height=null,selectedImage.titlecorrectorX=0,selectedImage.titlecorrectorY=0;let canvas=null,canvaswidth=600,canvasheight=400;function refreshCanvasSize(){canvas=document.getElementById("unilabel-imageboard-background-canvas"),canvaswidth=canvas.clientWidth,canvasheight=canvas.clientHeight}function dragStart(event){if(console.log("event.target.getAttribute('id').split('edit-icon-')[1]",event.target.getAttribute("id").split("edit-icon-")[1]),event.target&&event.target.getAttribute("id")&&event.target.getAttribute("id").split("edit-icon-")[1]>=1)return void console.log("Icon nummer=",event.target.getAttribute("id").split("edit-icon-")[1]);let selectedType="nix";if(selectedType=event&&event.explicitOriginalTarget&&event.explicitOriginalTarget.classList&&event.explicitOriginalTarget.classList.contains("unilabel-imageboard-image")?"image":"title",event&&event.target&&event.target.classList.contains("unilabel-imageboard-element-draggable")){let number=event.target.getAttribute("id").split("unilabel-imageboard-element-")[1],imagedata=function(number){let imageids={title:"id_unilabeltype_imageboard_title_"+number,titlecolor:"id_unilabeltype_imageboard_titlecolor_colourpicker",titlebackgroundcolor:"id_unilabeltype_imageboard_titlebackgroundcolor_colourpicker",titlelineheight:"id_unilabeltype_imageboard_titlelineheight",fontsize:"id_unilabeltype_imageboard_fontsize",xposition:"id_unilabeltype_imageboard_xposition_"+number,yposition:"id_unilabeltype_imageboard_yposition_"+number,targetwidth:"id_unilabeltype_imageboard_targetwidth_"+number,targetheight:"id_unilabeltype_imageboard_targetheight_"+number,src:"",border:"id_unilabeltype_imageboard_border_"+number,borderradius:"id_unilabeltype_imageboard_borderradius_"+number},imagedata={};imagedata.title=document.getElementById(imageids.title).value,imagedata.titlecolor=document.getElementById(imageids.titlecolor).value,imagedata.titlebackgroundcolor=document.getElementById(imageids.titlebackgroundcolor).value,imagedata.titlelineheight=document.getElementById(imageids.titlelineheight).value,imagedata.fontsize=document.getElementById(imageids.fontsize).value,imagedata.xposition=document.getElementById(imageids.xposition).value,imagedata.yposition=document.getElementById(imageids.yposition).value,imagedata.targetwidth=document.getElementById(imageids.targetwidth).value,imagedata.targetheight=document.getElementById(imageids.targetheight).value;const imagetag=document.getElementById("id_unilabeltype_imageboard_image_"+number+"_fieldset").getElementsByTagName("img");let src="";imagetag.length&&0!=imagetag.length&&(src=imagetag[0].src,src=src.split("?")[0]);return imagedata.src=src,imagedata.border=document.getElementById(imageids.border).value,imagedata.borderradius=document.getElementById(imageids.borderradius).value,imagedata}(number);selectedImage.number=number,selectedImage.title=imagedata.title,selectedImage.titlelineheight=imagedata.titlelineheight,selectedImage.fontsize=imagedata.fontsize,selectedImage.width=imagedata.targetwidth,selectedImage.height=imagedata.targetheight,selectedImage.itemToMove=document.getElementById("unilabel-imageboard-element-"+selectedImage.number),selectedImage.eventlayerX=event.layerX,selectedImage.eventlayerY=event.layerY,selectedImage.titlecorrectorY="title"==selectedType?selectedImage.fontsize*selectedImage.titlelineheight:0}}function dragEnd(event){let snap=1,snapelement=document.getElementById("unilabeltype-imageboard-snap");if(null!==snapelement&&Number.isInteger(Number(snapelement.value))&&(snap=snapelement.value),event.target&&event.target.getAttribute("id")&&event.target.getAttribute("id").split("edit-icon-")[1]>=1)console.log("Icon nummerrr=",event.target.getAttribute("id").split("edit-icon-")[1]);else if(function(target){console.log("marktargetasselected"),console.log("target",target);let technicalnumber=target.getAttribute("id").split("unilabel-imageboard-element-")[1];const singleElements=document.querySelectorAll('[id^="fitem_id_unilabeltype_imageboard_image_"]');for(let i=0;i<singleElements.length;i++){let number=singleElements[i].getAttribute("id").split("fitem_id_unilabeltype_imageboard_image_")[1];if(number){let image=document.getElementById("unilabel-imageboard-imageid-"+number);image&&image.classList.remove("selected");let title=document.getElementById("id_elementtitle-"+number);title&&title.classList.remove("selected")}}document.getElementById("unilabel-imageboard-imageid-"+technicalnumber).classList.add("selected"),document.getElementById("id_elementtitle-"+technicalnumber).classList.add("selected")}(event.target),null!==selectedImage.number){!function(number){const singleElements=document.querySelectorAll('[id^="fitem_id_unilabeltype_imageboard_title_"]');for(let i=0;i<singleElements.length;i++){let wrapperOfElement=getWrapper(i);wrapperOfElement&&number==i?wrapperOfElement.classList.remove("d-none"):wrapperOfElement.classList.add("d-none")}}(selectedImage.number);let xposition=function(event,snap){let canvasboundings=canvas.getBoundingClientRect(),xposition=event.clientX-canvasboundings.left-selectedImage.eventlayerX;xposition<0&&(xposition=0);xposition>=canvaswidth-selectedImage.width&&(xposition=canvaswidth-selectedImage.width);return Math.round(xposition/snap)*snap}(event,snap),yposition=function(event,snap){var canvasboundings=canvas.getBoundingClientRect(),yposition=event.clientY-canvasboundings.top-selectedImage.eventlayerY;yposition<0&&(yposition=0);yposition>=canvasheight-selectedImage.height&&(yposition=canvasheight-selectedImage.height);return Math.round(yposition/snap)*snap}(event,snap);selectedImage.itemToMove.style.left=xposition+selectedImage.titlecorrectorX+"px",selectedImage.itemToMove.style.top=parseInt(yposition)+parseInt(selectedImage.titlecorrectorY)+"px";const inputPositionX=document.getElementById("id_unilabeltype_imageboard_xposition_"+selectedImage.number);inputPositionX.value=xposition;const inputPositionY=document.getElementById("id_unilabeltype_imageboard_yposition_"+selectedImage.number);inputPositionY.value=parseInt(yposition)+parseInt(selectedImage.titlecorrectorY),document.getElementById("unilabel-imageboard-coordinates").innerHTML=parseInt(selectedImage.number)+1+": "+inputPositionX.value+" / "+inputPositionY.value,selectedImage.number=null,selectedImage.titlecorrectorY=0}}function getWrapper(number){console.log("getWrapper number=",number);let element=document.getElementById("fitem_id_unilabeltype_imageboard_title_"+number);console.log("element =",element);let wrapperElement=element.closest(".elementwrapper");return wrapperElement||null}refreshCanvasSize(),canvas.addEventListener("dragstart",dragStart,!1),canvas.addEventListener("dragend",dragEnd,!1),document.addEventListener("canvaschanged",refreshCanvasSize)}}));

//# sourceMappingURL=imageboarddraganddrop.min.js.map